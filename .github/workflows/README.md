# GitHub Actions Workflows

## Overview

DockLite –∏—Å–ø–æ–ª—å–∑—É–µ—Ç GitHub Actions –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- ‚úÖ **CI** - Unit —Ç–µ—Å—Ç—ã (backend + frontend)
- ‚úÖ **E2E** - End-to-end —Ç–µ—Å—Ç—ã —Å Playwright
- ‚úÖ **Setup Dev** - –ü—Ä–æ–≤–µ—Ä–∫–∞ `./docklite setup-dev`
- ‚úÖ **Type Check** - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤

---

## üåê E2E Tests

**–§–∞–π–ª:** `test-e2e.yml`

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ó–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ–ª–Ω—ã–µ end-to-end —Ç–µ—Å—Ç—ã —á–µ—Ä–µ–∑ Playwright –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.

### –ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

- ‚úÖ –ü—Ä–∏ –ø—É—à–µ –≤ `main` –∏–ª–∏ `dev` (–µ—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã frontend/backend/docker-compose)
- ‚úÖ –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Pull Request
- ‚úÖ –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ GitHub Actions UI

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è

**24 E2E —Ç–µ—Å—Ç–∞:**

#### Authentication (7 tests)
- Login form display
- Admin/user login
- Invalid credentials
- Logout
- Session persistence
- Protected routes

#### Admin User (9 tests)
- Access all views (Projects, Users, Containers, Traefik)
- See system containers
- System containers protection
- Create project/user dialogs
- Multi-tenant view

#### Non-Admin User (8 tests)
- Limited navigation
- See only own projects
- NOT see system containers
- NOT access admin pages

### Workflow Steps

```yaml
1. Checkout code
2. Setup Python 3.11 + Node.js 20
3. Install dependencies (npm ci + Playwright browsers)
4. Start DockLite (docker compose up)
5. Wait for services (health checks)
6. Create test users (cursor, testuser)
7. Run Playwright tests
8. Upload artifacts (reports, videos)
9. Cleanup (docker compose down)
```

### Test Users

–°–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- **cursor** (admin) - password: `CursorAI_Test2024!`
- **testuser** (user) - password: `TestUser_2024!`

### Artifacts

#### Playwright Report (always)
- –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –æ —Ç–µ—Å—Ç–∞—Ö
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è 30 –¥–Ω–µ–π
- –ü—Ä–æ—Å–º–æ—Ç—Ä: –°–∫–∞—á–∞—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –∏ –æ—Ç–∫—Ä—ã—Ç—å index.html

#### Test Videos (on failure)
- –í–∏–¥–µ–æ-–∑–∞–ø–∏—Å–∏ —É–ø–∞–≤—à–∏—Ö —Ç–µ—Å—Ç–æ–≤
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è 7 –¥–Ω–µ–π
- –ü–æ–º–æ–≥–∞–µ—Ç –≤ –æ—Ç–ª–∞–¥–∫–µ

### Service Logs

–ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –ª–æ–≥–∏:
- Backend logs
- Frontend logs
- Traefik logs

### Typical Run Time

- ‚è±Ô∏è Setup: ~3-4 –º–∏–Ω—É—Ç—ã
- ‚è±Ô∏è Tests: ~1-2 –º–∏–Ω—É—Ç—ã (24 tests)
- ‚è±Ô∏è Total: ~5-6 –º–∏–Ω—É—Ç

### Local Testing

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ –ø–µ—Ä–µ–¥ –ø—É—à–µ–º:
```bash
# Setup
cd frontend
npm install @playwright/test
npx playwright install chromium

# Create test users
./docklite add-user cursor -p "CursorAI_Test2024!" --admin
./docklite add-user testuser -p "TestUser_2024!" --user

# Run tests
./docklite test-e2e           # Headless
./docklite test-e2e --ui      # Interactive (recommended)
./docklite test-e2e --headed  # Show browser
```

### Troubleshooting

#### Tests timeout
- Increase timeout in `playwright.config.js`
- Check service health endpoints
- Review service logs

#### Flaky tests
- Add explicit waits: `waitForLoadState('networkidle')`
- Increase wait times for slow operations
- Run with `--workers=1` for serial execution

#### Authentication failures
- Verify test users created successfully
- Check JWT secret consistency
- Review auth flow logs

---

## üß™ Test Development Setup

**–§–∞–π–ª:** `test-setup-dev.yml`

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –∫–æ–º–∞–Ω–¥–∞ `./docklite setup-dev` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö –∏ –≤–µ—Ä—Å–∏—è—Ö Python.

### –ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

- ‚úÖ –ü—Ä–∏ –ø—É—à–µ –≤ `main` –∏–ª–∏ `dev` –≤–µ—Ç–∫–∏ (–µ—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –∏–ª–∏ CLI)
- ‚úÖ –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Pull Request –≤ `main` –∏–ª–∏ `dev`
- ‚úÖ –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ GitHub Actions UI (workflow_dispatch)

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è

#### 1. Linux (Ubuntu Latest)

- –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è `.venv/`
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ venv
- –°–æ–∑–¥–∞–Ω–∏–µ `.env` —Ñ–∞–π–ª–∞
- –†–∞–±–æ—Ç–∞ CLI –∫–æ–º–∞–Ω–¥ (`version`, `--help`)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ venv CLI-wrapper'–æ–º
- –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (–ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ `setup-dev`)

#### 2. macOS (Latest)

- –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞–∫ –¥–ª—è Linux
- **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –ø–∞–∫–µ—Ç—ã –ù–ï —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –≤ user site-packages
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `--break-system-packages`
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ Python

#### 3. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ Python

–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ Python:
- 3.8 (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–∞—è –≤–µ—Ä—Å–∏—è)
- 3.9
- 3.10
- 3.11
- 3.12 (latest)

### –ü—Ä–æ–≤–µ—Ä–∫–∏

```bash
# 1. venv —Å–æ–∑–¥–∞–Ω
test -d .venv

# 2. Python –≤ venv —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
test -f .venv/bin/python

# 3. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
.venv/bin/python -c "import typer, rich, dotenv, yaml"

# 4. .env —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω
test -f .env

# 5. CLI —Ä–∞–±–æ—Ç–∞–µ—Ç
./docklite version

# 6. CLI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç venv
./docklite version  # –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ —Ä—É—á–Ω–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ venv

# 7. –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
./docklite setup-dev  # –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–∞–¥–∞—Ç—å

# 8. –ß–∏—Å—Ç–æ—Ç–∞ —Å–∏—Å—Ç–µ–º—ã (macOS)
python3 -m pip list --user  # –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å typer/rich
```

### –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ GitHub ‚Üí Actions
2. –í—ã–±–µ—Ä–∏—Ç–µ "Test Development Setup"
3. –ù–∞–∂–º–∏—Ç–µ "Run workflow"
4. –í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ç–∫—É
5. –ù–∞–∂–º–∏—Ç–µ "Run workflow"

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–í—Å–µ 3 –¥–∂–æ–±—ã –∑–µ–ª—ë–Ω—ã–µ:**
- `test-setup-linux` ‚úÖ
- `test-setup-macos` ‚úÖ
- `test-setup-multiple-python` ‚úÖ
- `summary` ‚úÖ

### –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö

#### ModuleNotFoundError –≤ venv

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
cat scripts/requirements.txt

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏–∏
.venv/bin/pip list
```

#### CLI –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç venv

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ docklite wrapper
cat docklite | head -20

# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ–¥:
# if not in venv:
#     venv_python = venv_path / "bin" / "python"
#     if venv_python.exists():
#         os.execv(str(venv_python), ...)
```

#### macOS: –ø–∞–∫–µ—Ç—ã –≤ user site-packages

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è --user –∏–ª–∏ --break-system-packages
grep -r "\-\-user" scripts/
grep -r "break-system-packages" scripts/

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç–æ!
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫

–î–æ–±–∞–≤—å—Ç–µ —à–∞–≥ –≤ `test-setup-dev.yml`:

```yaml
- name: Your new check
  run: |
    # Your test commands
    if [ condition ]; then
      echo "‚úÖ Check passed"
    else
      echo "‚ùå Check failed"
      exit 1
    fi
```

### –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `scripts/cli/commands/development.py` - –∫–æ–º–∞–Ω–¥–∞ `setup-dev`
- `scripts/development/setup-dev.sh` - bash-–≤–µ—Ä—Å–∏—è (deprecated)
- `docklite` - CLI wrapper —Å auto-venv
- `scripts/requirements.txt` - –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ CLI
- `.env.example` - —à–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

–¢–∏–ø–∏—á–Ω–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
- Linux: ~2-3 –º–∏–Ω—É—Ç—ã
- macOS: ~3-4 –º–∏–Ω—É—Ç—ã
- Multiple Python: ~8-10 –º–∏–Ω—É—Ç (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)

**–ò—Ç–æ–≥–æ:** ~4-5 –º–∏–Ω—É—Ç –¥–ª—è –ø–æ–ª–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ

1. ‚úÖ **–ö—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å** - –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –Ω–∞ Linux –∏ macOS
2. ‚úÖ **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å Python** - —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç Python 3.8-3.12
3. ‚úÖ **–ß–∏—Å—Ç–æ—Ç–∞ —Å–∏—Å—Ç–µ–º—ã** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –Ω–µ –∑–∞–≥—Ä—è–∑–Ω—è–µ—Ç—Å—è system Python
4. ‚úÖ **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Ä–µ–≥—Ä–µ—Å—Å–∏–π** - –ª–æ–≤–∏—Ç –ø–æ–ª–æ–º–∫–∏ –¥–æ –º–µ—Ä–∂–∞
5. ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç–æ–π** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞–∫ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ –ø—É—à–µ–º

```bash
# –≠–º—É–ª–∏—Ä—É–π—Ç–µ CI –ª–æ–∫–∞–ª—å–Ω–æ
./docklite setup-dev
.venv/bin/python -c "import typer, rich, dotenv, yaml"
./docklite version
./docklite --help

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
./docklite setup-dev  # –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ –±–µ–∑ –æ—à–∏–±–æ–∫

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–∏—Å—Ç–æ—Ç—É (macOS)
python3 -m pip list --user | grep -E "(typer|rich)"  # –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç–æ
```

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ Python

```bash
# –°–æ–∑–¥–∞–π—Ç–µ venv —Å –Ω—É–∂–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π
python3.9 -m venv .venv-test
source .venv-test/bin/activate
pip install -r scripts/requirements.txt

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CLI
./docklite version
```

---

**–ê–≤—Ç–æ—Ä:** DockLite Team  
**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 2024-10  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready

