---
alwaysApply: true
description: DockLite project structure and architecture overview
---

# DockLite Project Overview

DockLite - multi-tenant ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ²ĞµĞ±-ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ¼ Ğ´Ğ»Ñ Ğ´ĞµĞ¿Ğ»Ğ¾Ñ Ğ¼Ğ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· docker-compose Ñ user isolation Ğ¸ role-based access control.

## Project Structure

```
/home/pavel/docklite/          # Main DockLite system
â”œâ”€â”€ backend/                   # FastAPI backend
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/              # API endpoints (auth, users, projects, containers, presets, deployment)
â”‚   â”‚   â”œâ”€â”€ core/             # Config, database, security
â”‚   â”‚   â”œâ”€â”€ models/           # SQLAlchemy models & Pydantic schemas
â”‚   â”‚   â”œâ”€â”€ services/         # Business logic (auth, project, docker, traefik)
â”‚   â”‚   â”œâ”€â”€ constants/        # Enums, messages
â”‚   â”‚   â”œâ”€â”€ exceptions/       # Custom exceptions
â”‚   â”‚   â”œâ”€â”€ utils/            # Formatters, responses, logger, hostname
â”‚   â”‚   â”œâ”€â”€ validators/       # Compose, domain validation
â”‚   â”‚   â””â”€â”€ presets/          # 14 docker-compose templates (Traefik-ready)
â”‚   â”œâ”€â”€ tests/                # Pytest tests (229 tests)
â”‚   â”œâ”€â”€ alembic/              # Database migrations (3 revisions)
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ frontend/                  # Vue.js 3 + PrimeVue frontend
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/       # Dialogs (CreateProject, EnvVars, DeployInfo)
â”‚   â”‚   â”œâ”€â”€ views/            # Router views (ProjectsView, UsersView)
â”‚   â”‚   â”œâ”€â”€ composables/      # Reusable logic (useProjects, useContainers, usePresets)
â”‚   â”‚   â”œâ”€â”€ config/           # Constants
â”‚   â”‚   â”œâ”€â”€ utils/            # Formatters, toast
â”‚   â”‚   â”œâ”€â”€ App.vue           # Main app with auth
â”‚   â”‚   â”œâ”€â”€ Login.vue         # Login form
â”‚   â”‚   â”œâ”€â”€ Setup.vue         # Initial setup form
â”‚   â”‚   â”œâ”€â”€ router.js         # Vue Router config
â”‚   â”‚   â””â”€â”€ api.js            # Axios API client
â”‚   â”œâ”€â”€ tests/                # Vitest tests (120+)
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ scripts/                   # Production scripts (18 total)
â”‚   â”œâ”€â”€ docklite.sh           # Main CLI wrapper
â”‚   â”œâ”€â”€ lib/                  # Common functions (hostname, utilities)
â”‚   â”œâ”€â”€ development/          # Dev scripts (6)
â”‚   â”œâ”€â”€ deployment/           # Setup scripts (3)
â”‚   â”œâ”€â”€ maintenance/          # Maintenance (6: +list-users)
â”‚   â””â”€â”€ completion/           # Bash completion (2)
â””â”€â”€ docker-compose.yml

/home/{system_user}/projects/  # User deployed projects (multi-tenant)
    â”œâ”€â”€ {project-slug}/        # Slug-based path (e.g., example-com-a7b2)
    â”‚   â”œâ”€â”€ docker-compose.yml
    â”‚   â””â”€â”€ .env
```

## Key Architecture Decisions

### Multi-Tenancy
- Each project belongs to a user (owner_id FK)
- Projects stored in `/home/{system_user}/projects/{slug}/`
- Slug-based paths (e.g., `example-com-a7b2`) instead of numeric IDs
- System-level isolation via Linux users
- Non-admin users see only their projects
- Admin users see all projects

### Deployment via SSH
- Each DockLite user maps to a Linux system_user
- Projects dir: `/home/{system_user}/projects/`
- Users upload files via rsync/scp/SFTP
- Docker operations execute as system_user

### Authentication & Authorization
- JWT authentication with bcrypt password hashing
- Role-based access control (admin vs user)
- Ownership checks on all operations
- Setup screen for first admin creation
- Password reset via CLI: `./docklite reset-password`

## Tech Stack

**Backend:**
- FastAPI (async)
- SQLAlchemy + Alembic (SQLite, migrateable to PostgreSQL)
- JWT (python-jose) + bcrypt (passlib)
- PyYAML for validation
- Pytest (78 tests, 94% coverage)

**Frontend:**
- Vue.js 3 (Composition API)
- Vue Router 4 (hash mode)
- PrimeVue UI components
- Axios for API calls
- Vitest for testing

## Current Phase Status

âœ… **Phase 1-3**: Production Ready
- Multi-tenant architecture
- Container management (start/stop/restart)
- Professional CLI
- Bash completion

âœ… **Phase 4**: Traefik v3 Integration (2025-10-29) - **COMPLETE**
- Modern reverse proxy (Traefik v3, not Nginx)
- Domain-based routing (no ports!)
- Dashboard security (admin-only)
- Unified hostname system
- 229 tests (95% coverage)
- Professional CLI (18 commands)

ğŸ”„ **Phase 5**: SSL/HTTPS with Let's Encrypt (next, 90% ready)
ğŸ”„ **Phases 6-9**: Planned

**See:** [phases-roadmap.mdc](mdc:phases-roadmap.mdc)

## Important Files

**Core:**
- [backend/app/main.py](mdc:backend/app/main.py) - FastAPI app entry point
- [backend/app/core/config.py](mdc:backend/app/core/config.py) - Settings (HOSTNAME, TRAEFIK_DASHBOARD_HOST)
- [docker-compose.yml](mdc:docker-compose.yml) - DockLite orchestration with Traefik v3

**Models & Services:**
- [backend/app/models/project.py](mdc:backend/app/models/project.py) - Project model (slug-based)
- [backend/app/models/user.py](mdc:backend/app/models/user.py) - User model
- [backend/app/services/traefik_service.py](mdc:backend/app/services/traefik_service.py) - Traefik labels (NEW)
- [backend/app/services/project_service.py](mdc:backend/app/services/project_service.py) - Project CRUD with Traefik

**Security & Utils:**
- [backend/app/core/security.py](mdc:backend/app/core/security.py) - JWT auth + cookie support
- [backend/app/utils/hostname.py](mdc:backend/app/utils/hostname.py) - Hostname detection (NEW)
- [backend/app/api/auth.py](mdc:backend/app/api/auth.py) - Auth endpoints + verify-admin

**Frontend:**
- [frontend/src/App.vue](mdc:frontend/src/App.vue) - Main app with Dashboard button
- [frontend/src/router.js](mdc:frontend/src/router.js) - Vue Router

**Scripts:**
- [scripts/lib/common.sh](mdc:scripts/lib/common.sh) - Hostname functions (get_hostname, get_access_url)
- [scripts/docklite.sh](mdc:scripts/docklite.sh) - CLI wrapper (18 commands)

**Documentation:**
- [README.md](mdc:README.md) - Main documentation
- [TRAEFIK.md](mdc:TRAEFIK.md) - Traefik guide (NEW)
- [PHASE_4_COMPLETE.md](mdc:PHASE_4_COMPLETE.md) - Phase 4 summary (NEW)

## CLI Usage

**Main CLI:** `./docklite <command>` (18 commands)

### Essential Commands
```bash
./docklite start              # Start system (with Traefik)
./docklite stop               # Stop system
./docklite status             # Check status + URLs
./docklite test               # Run all tests (229 backend + 120+ frontend)
./docklite list-users         # List all users (NEW)
./docklite reset-password     # Reset user password (enhanced)
./docklite backup             # Backup system
./docklite --help             # Show all commands
```

**Full docs:** [scripts/README.md](mdc:scripts/README.md)

## Testing

Always run tests after changes:
```bash
./docklite test               # All tests (229 backend + 120+ frontend)
./docklite test-backend       # Backend only (229 tests)
./docklite test-frontend      # Frontend only (120+ tests)

# Specific test categories
./docklite test-backend -k traefik    # Traefik tests (18)
./docklite test-backend -k hostname   # Hostname tests (20)
./docklite test-backend -k security   # Security tests (34)
bash scripts/lib/test_hostname.sh     # Bash hostname tests (6)
```

Expected: All tests passing âœ… (229 backend, 120+ frontend)
