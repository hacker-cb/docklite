---
description: DockLite project structure and architecture overview
tags: ["architecture", "overview"]
alwaysApply: true
---

# DockLite Project Overview

DockLite - multi-tenant ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ²ĞµĞ±-ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ¼ Ğ´Ğ»Ñ Ğ´ĞµĞ¿Ğ»Ğ¾Ñ Ğ¼Ğ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· docker-compose Ñ user isolation Ğ¸ role-based access control.

## ğŸš¨ CRITICAL: Development Environment Setup

**REQUIRED FOR ALL NEW AGENTS/DEVELOPERS:**

Before making ANY changes to the codebase, you MUST run:

```bash
./docklite setup-dev
```

**Why this is critical:**
- âœ… Creates isolated `.venv/` virtual environment
- âœ… Installs all CLI dependencies (typer, rich, python-dotenv, PyYAML)
- âœ… Sets up `.env` configuration
- âœ… Validates Docker is running
- âœ… Ensures consistent development environment

**DO NOT:**
- âŒ Install packages globally (`pip3 install` without venv)
- âŒ Skip this step and assume dependencies are installed
- âŒ Use `--user` or `--break-system-packages` flags
- âŒ Start working without proper environment

**The `./docklite` CLI wrapper automatically uses `.venv/` - no manual activation needed!**

If you encounter `ModuleNotFoundError` for typer/rich/etc, you skipped this step.

## Project Structure

```
<PROJECT_ROOT>/                # DockLite system (paths auto-detected)
â”œâ”€â”€ backend/                   # FastAPI backend
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/              # API endpoints (auth, users, projects, containers, presets, deployment)
â”‚   â”‚   â”œâ”€â”€ core/             # Config, database, security
â”‚   â”‚   â”œâ”€â”€ models/           # SQLAlchemy models & Pydantic schemas
â”‚   â”‚   â”œâ”€â”€ services/         # Business logic (auth, project, docker, traefik)
â”‚   â”‚   â”œâ”€â”€ constants/        # Enums, messages
â”‚   â”‚   â”œâ”€â”€ exceptions/       # Custom exceptions
â”‚   â”‚   â”œâ”€â”€ utils/            # Formatters, responses, logger, hostname
â”‚   â”‚   â”œâ”€â”€ validators/       # Compose, domain validation
â”‚   â”‚   â””â”€â”€ presets/          # Docker-compose templates (Traefik-ready)
â”‚   â”œâ”€â”€ tests/                # Pytest tests
â”‚   â”œâ”€â”€ alembic/              # Database migrations
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ frontend/                  # Vue.js 3 + PrimeVue frontend
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/       # Dialogs (CreateProject, EnvVars, DeployInfo)
â”‚   â”‚   â”œâ”€â”€ views/            # Router views (ProjectsView, UsersView)
â”‚   â”‚   â”œâ”€â”€ composables/      # Reusable logic (useProjects, useContainers, usePresets)
â”‚   â”‚   â”œâ”€â”€ config/           # Constants
â”‚   â”‚   â”œâ”€â”€ utils/            # Formatters, toast
â”‚   â”‚   â”œâ”€â”€ App.vue           # Main app with auth
â”‚   â”‚   â”œâ”€â”€ Login.vue         # Login form
â”‚   â”‚   â”œâ”€â”€ Setup.vue         # Initial setup form
â”‚   â”‚   â”œâ”€â”€ router.js         # Vue Router config
â”‚   â”‚   â””â”€â”€ api.js            # Axios API client
â”‚   â”œâ”€â”€ tests/                # Vitest tests
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ scripts/                   # CLI and automation
â”‚   â”œâ”€â”€ docklite.sh           # Main CLI wrapper
â”‚   â”œâ”€â”€ cli/                  # Python CLI (Typer + Rich)
â”‚   â”œâ”€â”€ lib/                  # Common functions (hostname, utilities)
â”‚   â”œâ”€â”€ development/          # Dev scripts
â”‚   â”œâ”€â”€ deployment/           # Setup scripts
â”‚   â”œâ”€â”€ maintenance/          # Maintenance scripts
â”‚   â””â”€â”€ completion/           # Bash completion
â””â”€â”€ docker-compose.yml

<PROJECTS_DIR>/                # User deployed projects (multi-tenant, configurable)
    â”œâ”€â”€ {project-slug}/        # Slug-based path (e.g., example-com-a7b2)
    â”‚   â”œâ”€â”€ docker-compose.yml
    â”‚   â””â”€â”€ .env
```

**Note:** Paths auto-detect based on script location. Works on macOS and Linux.

## Tech Stack

**Backend:**
- FastAPI (async)
- SQLAlchemy + Alembic (SQLite, migrateable to PostgreSQL)
- JWT (python-jose) + bcrypt (passlib)
- PyYAML for validation
- Pytest for testing

**Frontend:**
- Vue.js 3 (Composition API)
- Vue Router 4 (hash mode)
- PrimeVue UI components
- Axios for API calls
- Vitest + Playwright for testing

**CLI:**
- Python (Typer + Rich) in virtual environment
- Bash automation scripts
- Comprehensive bash completion

**Infrastructure:**
- Docker + Docker Compose
- Traefik v3 reverse proxy with domain routing
- Multi-tenant with user isolation

**Platform Support:**
- âœ… Development: macOS + Linux
- âœ… Production: Linux
- ğŸ³ Docker Desktop (macOS) or Docker Engine (Linux)

## Key Architecture Decisions

### Multi-Tenancy
- Each project belongs to a user (owner_id FK)
- Projects stored in `/home/{system_user}/projects/{slug}/`
- Slug-based paths (e.g., `example-com-a7b2`) instead of numeric IDs
- System-level isolation via Linux users
- Non-admin users see only their projects
- Admin users see all projects

### Deployment via SSH
- Each DockLite user maps to a Linux system_user
- Projects dir: `/home/{system_user}/projects/`
- Users upload files via rsync/scp/SFTP
- Docker operations execute as system_user

### Authentication & Authorization
- JWT authentication with bcrypt password hashing
- Role-based access control (admin vs user)
- Ownership checks on all operations
- Setup screen for first admin creation
- Password reset via CLI: `./docklite reset-password`

## Current Status

âœ… **Production Ready**
- Multi-tenant architecture
- Container management with system protection
- Traefik v3 reverse proxy with domain routing
- Professional CLI with bash completion
- Comprehensive test coverage

## CLI Usage

**Main CLI:** `./docklite <command>`

### First Time Setup
```bash
# One command to setup development environment
./docklite setup-dev          # Creates venv, installs deps, creates .env
```

### Essential Commands
```bash
./docklite start              # Start system (with Traefik)
./docklite stop               # Stop system
./docklite status             # Check status + URLs
./docklite test               # Run all tests
./docklite add-user <name>    # Add new user (interactive or with -p flag)
./docklite list-users         # List all users
./docklite reset-password     # Reset user password
./docklite backup             # Backup system
./docklite --help             # Show all commands
```

## Testing

Always run tests after changes:
```bash
./docklite test               # All tests (backend + frontend + CLI)
./docklite test-backend       # Backend only
./docklite test-frontend      # Frontend only
./docklite test-e2e           # E2E tests (requires Playwright)

# Or via Docker Compose
docker compose exec backend pytest -v
docker compose exec frontend npm test
cd frontend && npm run test:e2e       # E2E tests
```

## macOS Development

DockLite fully supports development on macOS. See `local-infra-macos.mdc` for details.

**Key differences:**
- âœ… All development features work
- âœ… Docker Desktop instead of Docker Engine
- âœ… venv works seamlessly (no --break-system-packages needed!)
- âš ï¸ Deployment commands (setup-user, setup-ssh) are Linux-only
- âœ… Use `./docklite setup-dev` for automatic setup
