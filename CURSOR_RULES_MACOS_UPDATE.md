# Cursor Rules - macOS Compatibility Update

**–î–∞—Ç–∞:** 2025-10-30  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### –ù–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ: `macos-compatibility.mdc`

–°–æ–∑–¥–∞–Ω–æ –Ω–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ `.cursor/rules/macos-compatibility.mdc` —Å –ø–æ–ª–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π –ø–æ –∫—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.

**–°–æ–¥–µ—Ä–∂–∏—Ç:**
- ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ macOS
- ‚ùå –ß—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (Linux-only)
- üîß –ü–∞—Ç—Ç–µ—Ä–Ω—ã –Ω–∞–ø–∏—Å–∞–Ω–∏—è –∫—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
- üìã Setup –∏ workflow –¥–ª—è macOS
- üöÄ Production deployment —Å macOS
- üß™ –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- üéØ Best practices –∏ –ø—Ä–∏–º–µ—Ä—ã

### –û–±–Ω–æ–≤–ª–µ–Ω–æ: `00-project-overview.mdc`

1. **–î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è Platform Support:**
   ```
   Platform Support:
   - ‚úÖ Development: macOS + Linux
   - ‚úÖ Production: Linux
   - üê≥ Docker Desktop (macOS) or Docker Engine (Linux)
   ```

2. **–û–±–Ω–æ–≤–ª–µ–Ω—ã –ø—É—Ç–∏ –≤ Project Structure:**
   - –ë—ã–ª–æ: `/home/pavel/docklite/`
   - –°—Ç–∞–ª–æ: `<PROJECT_ROOT>/` (auto-detected)
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–º–µ—Ç–∫–∞: "Paths auto-detect based on script location. Works on macOS and Linux."

3. **–î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è macOS Development:**
   - –°—Å—ã–ª–∫–∞ –Ω–∞ –Ω–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ
   - –ö–ª—é—á–µ–≤—ã–µ –æ—Ç–ª–∏—á–∏—è
   - –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç/–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

4. **–û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è Testing:**
   - –î–æ–±–∞–≤–ª–µ–Ω –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± —á–µ—Ä–µ–∑ Docker Compose
   - –ö—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

## –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### 1. –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—É—Ç–µ–π (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)

**‚ùå –ù–ò–ö–û–ì–î–ê:**
```python
PROJECT_ROOT = Path("/home/pavel/docklite")
```

**‚úÖ –í–°–ï–ì–î–ê:**
```python
SCRIPTS_DIR = Path(__file__).parent.parent.absolute()
PROJECT_ROOT = SCRIPTS_DIR.parent
```

**Bash:**
```bash
get_project_root() {
    local script_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
    echo "$(cd "$script_dir/../.." && pwd)"
}
```

### 2. Docker Group Detection

**‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ:**
```python
def has_docker_group() -> bool:
    # On macOS, docker group doesn't exist - skip sg
    if not shutil.which("sg"):
        return True  # macOS - no group switching needed
    
    # Linux logic...
```

**Bash:**
```bash
if command -v sg &> /dev/null && ! groups | grep -q docker; then
    sg docker -c "docker-compose up"
else
    docker-compose up  # macOS or in group
fi
```

### 3. Platform-Specific Commands

**–ü—Ä–æ–≤–µ—Ä—è–π —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥:**
```bash
if command -v hostnamectl &> /dev/null; then
    # Linux
else
    # macOS
fi
```

### 4. Linux-Only Functions

**–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π –∏ –ø—Ä–æ–≤–µ—Ä—è–π:**
```python
def create_system_user(username: str):
    """Create Linux system user (Linux only)."""
    if sys.platform != "linux":
        raise NotImplementedError("Requires Linux")
```

## –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª

### –ö–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫:**
- `scripts/**/*.py` - Python CLI
- `scripts/**/*.sh` - Bash —Å–∫—Ä–∏–ø—Ç—ã
- `backend/**/*.py` - Backend –∫–æ–¥

**–í—Å–µ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è:**
- `00-project-overview.mdc` - base overview (alwaysApply: true)

### –ö–∞–∫ Cursor –∏—Å–ø–æ–ª—å–∑—É–µ—Ç

Cursor –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –£—á–∏—Ç—ã–≤–∞–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞
2. –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∫—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è
3. –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç –æ Linux-only —Ñ—É–Ω–∫—Ü–∏—è—Ö
4. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—É—Ç–∏

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –≤ –∫–æ–¥–µ

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **`scripts/cli/config.py`**
   - –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ PROJECT_ROOT
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Path.home()

2. **`scripts/lib/common.sh`**
   - –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ project root
   - –£—Å–ª–æ–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ sg docker

3. **`scripts/cli/utils/docker.py`**
   - macOS detection –≤ has_docker_group()
   - –ü—Ä–æ–ø—É—Å–∫ sg –Ω–∞ macOS

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **`.env`** (template)
   - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è macOS
   - HOSTNAME=localhost
   - PROJECTS_DIR=/Users/pavel/...

2. **`MACOS_COMPATIBILITY.md`**
   - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
   - Setup –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
   - Troubleshooting

3. **`.cursor/rules/macos-compatibility.mdc`**
   - –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è Cursor
   - –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∏ –ø—Ä–∏–º–µ—Ä—ã

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª

Cursor –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞. –ü—Ä–æ–≤–µ—Ä—å:

```bash
# –í Cursor –ø–æ–ø—Ä–æ–±—É–π —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
# Cursor –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∫—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π –∫–æ–¥

# –ù–∞–ø—Ä–∏–º–µ—Ä, —Å–æ–∑–¥–∞–π test.py —Å –ø—É—Ç—è–º–∏
# Cursor –ø—Ä–µ–¥–ª–æ–∂–∏—Ç Path(__file__) –≤–º–µ—Å—Ç–æ —Ö–∞—Ä–¥–∫–æ–¥–∞
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è –Ω–æ–≤—ã—Ö —Ñ–∏—á

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π auto-detect –ø—É—Ç–µ–π**
2. **–ü—Ä–æ–≤–µ—Ä—è–π —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º**
3. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π Linux-only —Ñ—É–Ω–∫—Ü–∏–∏**
4. **–¢–µ—Å—Ç–∏—Ä—É–π –Ω–∞ –æ–±–µ–∏—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ**

### –î–ª—è code review

–ü—Ä–æ–≤–µ—Ä—è–π:
- ‚ùå –ù–µ—Ç —Ö–∞—Ä–¥–∫–æ–¥–∞ –ø—É—Ç–µ–π
- ‚ùå –ù–µ—Ç –ø—Ä—è–º–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `sg docker`
- ‚ùå –ù–µ—Ç Linux-only –∫–æ–º–∞–Ω–¥ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Path.home()
- ‚úÖ –ï—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ command existence

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–ü—Ä–∞–≤–∏–ª–∞:** `.cursor/rules/macos-compatibility.mdc`
- **–ì–∞–π–¥:** `MACOS_COMPATIBILITY.md`
- **Overview:** `.cursor/rules/00-project-overview.mdc`

## –ò—Ç–æ–≥

‚úÖ –í—Å–µ –ø—Ä–∞–≤–∏–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –∫—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏  
‚úÖ Cursor –±—É–¥–µ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã  
‚úÖ –ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ macOS –∏ Linux  
‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª–Ω–∞—è –∏ –∞–∫—Ç—É–∞–ª—å–Ω–∞—è  

---

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏ Cursor (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
2. –ü–æ–ø—Ä–æ–±—É–π —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–æ–¥ - –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏–º–µ–Ω—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
3. –ü—Ä–∏ code review –∏—Å–ø–æ–ª—å–∑—É–π –ø—Ä–∞–≤–∏–ª–∞ –∫–∞–∫ checklist

